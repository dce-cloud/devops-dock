#### yapi ####

YapiRouterAnchor: &YapiRouterAnchor
  rule: "Host(`yapi.devops.top`)"
  service: YapiSvc
  middlewares:

#### zentao ####

ZentaoRouterAnchor: &ZentaoRouterAnchor
  rule: "Host(`zentao.devops.cn`)"
  service: ZentaoSvc
  middlewares:

#### NeneData ####

NineDataRouterAnchor: &NineDataRouterAnchor
  rule: "Host(`ninedata.devops.top`)"
  service: NinedataSvc
  middlewares:

#### Http ####

http:
  services:
    YapiSvc:
      loadBalancer:
        servers:
          - url: "http://yapi:3000"
    ZentaoSvc:
      loadBalancer:
        servers:
          - url: "http://zentao:80"
    NinedataSvc:
      loadBalancer:
        servers:
          - url: "http://ninedata:9999"
    Whoami1Svc:
      loadBalancer:
        servers:
          - url: "http://whoami1:80"
    Whoami2Svc:
      loadBalancer:
        servers:
          - url: "http://whoami2:80"

  middlewares:
    Whoami1Replacepathregex:
      replacePathRegex:
        regex: "^/api/english/(.*)"
        replacement: "/api/${1}"
    Whoami2Replacepathregex:
      replacePathRegex:
        regex: "^/api/math/(.*)"
        replacement: "/api/${1}"

  routers:

    #### yapi ####

    YapiHttp:
      <<: *YapiRouterAnchor
      entryPoints:
        - web
      priority: 100

    #### zentao ####

    ZentaoHttp:
      <<: *ZentaoRouterAnchor
      entryPoints:
        - web
      priority: 100

    #### ninedata ####
    NinedataHttp:
      <<: *NineDataRouterAnchor
      entryPoints:
        - web
      priority: 100

    Whoami1:
      entryPoints:
        - web
      rule: "Host(`whoami1.devops.top`) && PathPrefix(`/api/english/`)"
      service: Whoami1Svc
      middlewares:
        - Whoami1Replacepathregex
        
    Whoami2:
      entryPoints:
        - web
      rule: "Host(`whoami2.devops.top`) && PathPrefix(`/api/math/`)"
      service: Whoami2Svc
      middlewares:
        - Whoami2Replacepathregex
